name: Generate Ubuntu 20.04 Rootfs

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Step 2: Install dependencies for debootstrap
      - name: Install debootstrap
        run: |
          sudo apt-get update
          sudo apt-get install -y debootstrap
      # Step 3: Create the Ubuntu 22.04 root filesystem using debootstrap
      - name: Create Ubuntu 22.04 root filesystem
        run: |
          sudo mkdir base
          sudo debootstrap --arch=amd64 jammy base http://archive.ubuntu.com/ubuntu/
      # Step 4: Compress the generated rootfs into a tarball
      - name: Compress root filesystem
        run: |
          cd base
          sudo tar cJf ../ubuntu-rootfs.tar.xz *
      # Step 5: Upload the rootfs tarball as an artifact
      - name: Upload rootfs tarball
        uses: actions/upload-artifact@v4
        with:
          name: ubuntu-rootfs
          path: ubuntu-rootfs.tar.xz

